package controllers;

import java.awt.image.BufferedImage;
import java.io.File;
import java.io.IOException;
import java.util.Set;

import javax.imageio.ImageIO;

import org.apache.commons.io.FileUtils;
import org.imgscalr.Scalr;

import play.mvc.Controller;
import play.mvc.Http.MultipartFormData;
import play.mvc.Http.MultipartFormData.FilePart;
import play.mvc.Result;
import redis.clients.jedis.Jedis;
import views.html.index;
import views.html.learn;

public class Application extends Controller {

    public static Result index() {
    	Jedis jedis = new Jedis("localhost");
    	//jedis.sadd("mylist","a");
    	//jedis.sadd("mylist","b");
    	Set<String> smembers = jedis.smembers("mylist");
    	jedis.save();
        return ok(index.render("Your new application is ready."));
    }
    
    public static Result learnForm() {
		return ok(learn.render(""));    	
    }
    
    public static Result learnPicture() {
    	 MultipartFormData body = request().body().asMultipartFormData();
    	  FilePart picture = body.getFile("picture");
    	  if (picture != null) {
    	    String fileName = picture.getFilename();
    	    String contentType = picture.getContentType(); 
    	    File file = picture.getFile();
            
    	    BufferedImage image = ImageIO.read(file);
    	    BufferedImage thumbnail =
    	    		  Scalr.resize(image, Scalr.Method.SPEED, Scalr.Mode.FIT_TO_WIDTH,
    	    		               150, 100, Scalr.OP_ANTIALIAS);
    	    	
    	    	
    	    try {
                FileUtils.moveFile(file, new File("public/images/", fileName));
            } catch (IOException ioe) {
                System.out.println("Problem operating on filesystem");
            }
    	    return ok("File uploaded");
    	  } else {
    	    flash("error", "Missing file");
    	    return redirect(routes.Application.index());    
    	  }   	
    }
    
    

}
